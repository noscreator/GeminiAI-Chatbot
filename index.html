<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple Chat Bot Using Gemini API</title>
  <link rel="stylesheet" href="./assets/css/main.css">

  <link rel="stylesheet" href="./assets/css/markdown.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Lato:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap">

</head>

<body>
  <header>
    <div class="flex"><img class="logo" src="./assets/img/nexosai.jpg" alt="Logo">
      <h2>Nexos Ai</h2>
    </div>
    <button class="menu-btn" id="clear-button"><svg class='line' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
        <g>
          <path
            d='M93.53773,266.1295l-7.25984-3.848a1.8661,1.8661,0,0,1,0-3.29762l7.25984-3.848a3.73218,3.73218,0,0,1,3.49574,0l7.25985,3.848a1.8661,1.8661,0,0,1,0,3.29762l-7.25985,3.848A3.73223,3.73223,0,0,1,93.53773,266.1295Z'
            transform='translate(-83.2856 -252.70127)'></path>
          <path
            d='M104.29332,267.12105a1.8661,1.8661,0,0,1,0,3.29762l-7.25985,3.848a3.73223,3.73223,0,0,1-3.49574,0l-7.25984-3.848a1.8661,1.8661,0,0,1,0-3.29762'
            transform='translate(-83.2856 -252.70127)'></path>
        </g>
      </svg></button>
  </header>

  <!-- Sidebar 
  <aside class="flex">
    <div
      class="flex h-[100svh] w-60 flex-col overflow-y-auto bg-slate-50 pt-8 dark:border-slate-700 dark:bg-slate-900 sm:h-[100vh] sm:w-64">
      <div class="flex px-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-600" fill="currentColor" stroke-width="1"
          viewBox="0 0 24 24">
          <path
            d="M20.553 3.105l-6 3C11.225 7.77 9.274 9.953 8.755 12.6c-.738 3.751 1.992 7.958 2.861 8.321A.985.985 0 0012 21c6.682 0 11-3.532 11-9 0-6.691-.9-8.318-1.293-8.707a1 1 0 00-1.154-.188zm-7.6 15.86a8.594 8.594 0 015.44-8.046 1 1 0 10-.788-1.838 10.363 10.363 0 00-6.393 7.667 6.59 6.59 0 01-.494-3.777c.4-2 1.989-3.706 4.728-5.076l5.03-2.515A29.2 29.2 0 0121 12c0 4.063-3.06 6.67-8.046 6.965zM3.523 5.38A29.2 29.2 0 003 12a6.386 6.386 0 004.366 6.212 1 1 0 11-.732 1.861A8.377 8.377 0 011 12c0-6.691.9-8.318 1.293-8.707a1 1 0 011.154-.188l6 3A1 1 0 018.553 7.9z">
          </path>
        </svg>
        <h2 class="px-5 text-lg font-medium text-slate-800 dark:text-slate-200">
          Chats
          <span class="mx-2 rounded-full bg-blue-600 px-2 py-1 text-xs text-slate-200">6</span>
        </h2>
      </div>
      <div class="mx-2 mt-8">
        <button
          class="flex w-full gap-x-4 rounded-lg border border-slate-300 p-4 text-left text-sm font-medium text-slate-700 transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 5l0 14"></path>
            <path d="M5 12l14 0"></path>
          </svg>
          New Chat
        </button>
      </div>
      <div class="h-1/2 space-y-4 overflow-y-auto border-b border-slate-300 px-2 py-4 dark:border-slate-700">
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg px-3 py-2 text-left transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:hover:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            Tailwind Classes
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">12 Mar</p>
        </button>
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg bg-slate-200 px-3 py-2 text-left transition-colors duration-200 focus:outline-none dark:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            explain quantum computing
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">10 Feb</p>
        </button>
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg px-3 py-2 text-left transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:hover:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            How to create ERP Diagram
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">22 Jan</p>
        </button>
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg px-3 py-2 text-left transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:hover:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            API Scaling Strategies
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">1 Jan</p>
        </button>
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg px-3 py-2 text-left transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:hover:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            What is GPT UI?
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">1 Jan</p>
        </button>
        <button
          class="flex w-full flex-col gap-y-2 rounded-lg px-3 py-2 text-left transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:hover:bg-slate-800">
          <h1 class="text-sm font-medium capitalize text-slate-700 dark:text-slate-200">
            How to use Tailwind components?
          </h1>
          <p class="text-xs text-slate-500 dark:text-slate-400">1 Jan</p>
        </button>
      </div>
      <div class="mt-auto w-full space-y-4 px-2 py-4">
        <button
          class="flex w-full gap-x-2 rounded-lg px-3 py-2 text-left text-sm font-medium text-slate-700 transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:text-slate-200 dark:hover:bg-slate-800">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
            <path d="M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
            <path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"></path>
          </svg>
          User
        </button>
        <button
          class="flex w-full gap-x-2 rounded-lg px-3 py-2 text-left text-sm font-medium text-slate-700 transition-colors duration-200 hover:bg-slate-200 focus:outline-none dark:text-slate-200 dark:hover:bg-slate-800">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path
              d="M19.875 6.27a2.225 2.225 0 0 1 1.125 1.948v7.284c0 .809 -.443 1.555 -1.158 1.948l-6.75 4.27a2.269 2.269 0 0 1 -2.184 0l-6.75 -4.27a2.225 2.225 0 0 1 -1.158 -1.948v-7.285c0 -.809 .443 -1.554 1.158 -1.947l6.75 -3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98h-.033z">
            </path>
            <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
          </svg>
          Settings
        </button>
      </div>
    </div>
  </aside> -->

  <main>
    <div id="chat-container">
      <div id="chat-messages">
        <!-- chat massages here-->
      </div>
      <form id="chat-input">
        <div>
          <button type="button">
            <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M12 5l0 14"></path>
              <path d="M5 12l14 0"></path>
            </svg>
          </button>
        </div>
        <input id="user-input" type="text" placeholder="Enter your prompt" />
        <div>
          <button id="send-button" type="submit">
            <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M10 14l11 -11"></path>
              <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5"></path>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </main>

  <footer>
    <div class="credit">
      <p>&copy; 2024 Nexos AI. All rights reserved.</p>
    </div>
    <div class="back-to-top" id="backToTopBtn">
      <a href="#top"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
          <g
            transform='translate(12.000000, 12.000000) rotate(-180.000000) translate(-12.000000, -12.000000) translate(5.500000, 4.000000)'>
            <line x1='6.7743' y1='15.7501' x2='6.7743' y2='0.7501'></line>
            <path
              d='M12.7988,9.6998 C12.7988,9.6998 9.5378,15.7498 6.7758,15.7498 C4.0118,15.7498 0.7498,9.6998 0.7498,9.6998'>
            </path>
          </g>
        </svg></a>
    </div>
  </footer>

  <script type="importmap">
    {
          "imports": {
            "@google/generative-ai": "https://esm.run/@google/generative-ai"
          }
        }
      </script>
  <script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";


    // Define constants
    const API_KEY = 'AIzaSyBqfxSfrBIgcYSQo6DN3xdc8Wel8HtIpHQ'; // Replace with your Gemini API key

    // Initialize Gemini AI
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: 'gemini-pro' });
    const chat = model.startChat({
      generationConfig: {
        maxOutputTokens: 2024,
      },
    });

    // Define variables for DOM elements
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const clearButton = document.getElementById('clear-button');
    const chatMessages = document.getElementById('chat-messages');

    // Event listener for clearing the chat history
    clearButton.addEventListener('click', () => {
      chatMessages.innerHTML = '';
      localStorage.removeItem('chatMessages');
      alert('Chat history cleared successfully.');
    });

    // Define function to save messages to local storage
    function saveMessages(messages) {
      try {
        localStorage.setItem('chatMessages', JSON.stringify(messages));
      } catch (error) {
        console.error('Error saving messages to local storage:', error);
        // Handle the error gracefully, such as displaying a user-friendly error message
        alert('An error occurred while saving messages. Please try again later.');
      }
    }

    // Define function to load messages from local storage
    function loadMessages() {
      try {
        const savedMessages = localStorage.getItem('chatMessages');
        return savedMessages ? JSON.parse(savedMessages) : [];
      } catch (error) {
        console.error('Error loading messages from local storage:', error);
        // Handle the error gracefully, such as returning an empty array
        return [];
      }
    }

    // Load saved messages when the page is loaded
    let messages = loadMessages();
    displayMessages(); // Add this line to display the loaded messages

    // Function to display messages
    async function displayMessages() {
      chatMessages.innerHTML = `<div class="layer-01">
          <div class="card">
          <h2>Welcome to Nexos AI</h2>
          <p>Revolutionizing the way you interact with artificial intelligence.</p>
         </div></div> `;
      messages.forEach(message => {
        const messageDiv = document.createElement('div');
        const htmloutput = marked.parse(message.text);
        messageDiv.classList.add('message');
        messageDiv.classList.add(message.role);
        messageDiv.innerHTML = `
      <div class="fe2a9c">
        <img src="./assets/img/logo.png" />
        <h4>${message.role}</h4></div>
      <div class="content">
        ${htmloutput}
      </div>
            `;
        chatMessages.appendChild(messageDiv);
      });
    } // Add this line to close the function definition

    // Event listener for sending a message
    sendButton.addEventListener('click', async () => {
      const msg = userInput.value.trim();
      if (msg !== '') {
        try {
          messages.push({ role: 'User', text: msg });
          displayMessages();
          const result = await chat.sendMessage(msg);
          const response = await result.response;
          const markdownText = response.text();
          messages.push({ role: 'NexosAi', text: markdownText });
          displayMessages();
          saveMessages(messages);
        } catch (error) {
          console.error('Error sending message:', error);
          // Provide fallback response
          const fallbackResponse = 'Sorry, an error occurred while processing your request. Please try again later.';
          // Display fallback response
          messages.push({ role: 'User', text: msg });
          messages.push({ role: 'NexosAi', text: fallbackResponse });
          displayMessages();
          saveMessages(messages);
        }
        userInput.value = ''; // Clear input field after sending message
      }
    }); // Add this line to close the event listener
  </script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="./scripts/main.js"></script>
</body>

</html>